source('C:/Users/renz/Desktop/SNU 4차 산업혁명 아카데미/r4ds/r4ds_transformation.R', echo=TRUE)
install.packages("nycflights13")
library(nycflights13)
library(tidyverse)
head(flights)
# filter(), arrange(), select(), mutate(), summarise(), group_by()
filter(flights, month == 1, day == 1)
# dplyr package
# filter(), arrange(), select(), mutate(), summarise(), group_by()
jan1 <- filter(flights, month == 1, day == 1)
(dec25 <- filter(flights, month == 12, day == 25))
near(sqrt(2)^2 == 2)
near(sqrt(2)^2, 2)
nov_dec <- filter(flights, month %in% c(11,12))
dfna <- tibble(x = c(1,NA,3))
filter(dfna, x>1)
arrange(flights, year, month, day)
arrange(flights, desc(dep_delay))
arrange(dfna, x)
arrange(dfna, x); arrange(dfna, desc(x))
select(flights, year, month, day)
select(flights, year:day)
select(flights, -(year:day))
# select has many sub functions-----starts_with("abc"), ends_with("xyz"), contains("ijk"), matches("(.)\\1"), num_range("x", 1:3)
# select also has rename function, but it is recommended to use it separately like rename(flights, tail_num = tailnum)
select(flights, time_hour, air_time, everything())
flights_sml <- select(flights,
year:day,
ends_with("delay"),
distance,
air_time
)
mutate(flights_sml,
gain = dep_delay - arr_delay,
speed = distance/air_time * 60
)
View()
View(flights_sml)
# View(flights_sml) # if you want to see all variables it is better than seeing console
transmute(flights_sml,
gain = dep_delay - arr_delay,
speed = distance/air_time* 60,
gain_per_hour = gain/hours
)
# View(flights_sml) # if you want to see all variables it is better than seeing console
transmute(flights_sml,
gain = dep_delay - arr_delay,
hours = air_time / 60,
gain_per_hour = gain/hours
)
x <- 1:10
x <- 1:10; x
lag(x)
lead(x)
select(flights, dep_time, sched_dep_time)
select(flights, dep_time, sched_dep_time) %>%
filter(dep_time > 600)
select(flights, dep_time, sched_dep_time) %>%
filter(dep_time <= 602)
select(flights, dep_time, sched_dep_time) %>%
filter(dep_time <= 602, dep_time > 550)
select(flights, dep_time, sched_dep_time) %>%
filter(dep_time <= 602, dep_time > 555)
select(flights, dep_time, sched_dep_time) %>%
filter(dep_time <= 602, dep_time > 558)
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100)
?Date
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = paste(dep_hour,":", dep_min),
sched = paste(sched_hour, ":", sched_min))
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = as.Date(paste(dep_hour,":", dep_min)),
sched = as.Date(paste(sched_hour, ":", sched_min)))
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = as.Date(paste(dep_hour,":", dep_min), "%h%m"),
sched = as.Date(paste(sched_hour, ":", sched_min), "%h%m"))
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = as.Date(paste(dep_hour+":"+ dep_min), "%h%m"),
sched = as.Date(paste(sched_hour, ":", sched_min), "%h%m"))
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = as.Date(paste0(dep_hour,":", dep_min), "%h%m"),
sched = as.Date(paste0(sched_hour, ":", sched_min), "%h%m"))
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = as.Date(paste0(dep_hour,":", dep_min), "%h:%m"),
sched = as.Date(paste0(sched_hour, ":", sched_min), "%h:%m"))
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = as.Date(paste0(dep_hour,":", dep_min), "%H:%M"),
sched = as.Date(paste0(sched_hour, ":", sched_min), "%H:%M"))
select(flights, dep_time, sched_dep_time) %>%
transmute(dep_hour = dep_time %/% 100,
dep_min = dep_time %% 100,
sched_hour = sched_dep_time %/% 100,
sched_min = sched_dep_time %% 100) %>%
transmute(dep = as.POSIXct(paste0(dep_hour,":", dep_min), "%H:%M"),
sched = as.Date(paste0(sched_hour, ":", sched_min), "%H:%M"))
summarise(flights, delay = mean(dep_delay, na.rm = T))
flights %>%
group_by(flights, year, month, day) %>%
summarise(delay = mean(dep_delay), na.rm=T)
flights %>%
group_by(flights, year, month, day) %>%
summarise(delay = mean(dep_delay, na.rm=T))
flights %>%
group_by(year, month, day) %>%
summarise(delay = mean(dep_delay, na.rm=T))
delays <- flights %>%
group_by(dest) %>%
summarise(
count = n(),
dist = mean(distance, na.rm = T),
delay = mean(arr_delay, na.rm = T)
) %>%
filter(count > 20, dest != "HNL")
delays
ggplot(delays, aes(dist, delay)) + geom_point(aes(size = count), alpha = 1/3) + geom_smooth(se=FALSE)
not_cancelled <- flights %>%
filter(!is.na(dep_delay), !is.na(arr_delay))
delays <- not_cancelled %>%
group_by(tailnum) %>%
summarise(
n = n(),
delay = mean(arr_delay, na.rm = T)
)
ggplot(delays, aes(n, delay)) + geom_point(alpha = 1/10)
delays %>%
filter(n > 25) %>%
ggplot(aes(n,delay)) + geom_point(alpha = 1/10)
daily <- group_by(flights, year, month, day)
(per_day   <- summarise(daily, flights = n()))
(per_month <- summarise(per_day, flights = sum(flights)))
(per_year  <- summarise(per_month, flights = sum(flights)))
(per_year  <- summarise(per_month, flights = sum(flights)))
daily %>%
ungroup() %>%             # no longer grouped by date
summarise(flights = n())  # all flights
daily
flights_sml %>%
group_by(year, month, day) %>%
filter(rank(desc(arr_delay)) < 10)
filter(flights_sml,rank(desc(arr_delay)) < 10)
flights_sml %>%
group_by(year, month, day) %>%
filter(rank(desc(arr_dela
flights_sml %>%
group_by(year, month, day)
flights_sml %>%
group_by(year, month, day)
flights_sml %>%
group_by(year, month, day) %>%
filter(rank(desc(arr_delay)) < 10)
vv <- flights_sml %>%
group_by(year, month, day) %>%
filter(rank(desc(arr_delay)) < 10)
View(vv)
popular_dests
popular_dests <- flights %>%
group_by(dest) %>%
filter(n() > 365)
popular_dests
popular_dests %>%
filter(arr_delay > 0) %>%
mutate(prop_delay = arr_delay / sum(arr_delay)) %>%
select(year:day, dest, arr_delay, prop_delay)
